# Offline Ergodox gui configuration tool for Ubuntu
### You can configure your Ergodox for any layout 
You press a key and this tool guesses what your keyboard sends and make 
ergodox copy that. 

### WARNING  
This tool has only been tested with ubuntu16LTS and a JIS keyboard, 
thus likely contains uncaught bugs for other types of keyboards
and platforms.  
As of now, windows is not supported;adding support should be easy though.  
And as usual, this script comes with no warrant of fitness, no support, 
you are on your own and a developer yourself.

### Drawbacks
Keyboard layout you use to configure Ergodox and the keyboard layout you will be using
with ergodox must match.  
![Alt text](image4288.png?raw=true "Title")
  
Otherwise hilarity ensues.   
I created an ergodox keymap.c for programmer dvorak using programmer dvorak layout 
and was surprised to find it is a standard qwerty when I used it with jis layout! Wow!

### How does this work?
By capturing x11 keycode(key position) and guessing the signal the keyboard sent to
generate it; `/NoneGUIComponents/x11_to_hid_usage_id_map.py` is the
conversion map.

### Does this work with other linux distributions?
I do not know...   
Linux translates what the keyboard sends in chains:  

    1. keyboard sends hidbp packets containing hid usage id 
    2. driver translates it to kernel keycode(similar to scancode set one)
    3. xserver translates kernel keycode to x11 keycode 
    4. xserver translates x11 keycode to literals like a,b,c,...z etc.
   
For the sake of compatibility, I'm guessing most linux distributions share
the translation rule in the above process. Only a guess though.


## Dependencies:  

    d@d:~/PycharmProjects/GUIConfigurator$ pipreqs $(pwd)
    INFO: Successfully saved requirements file in /home/d/PycharmProjects/GUIConfigurator/requirements.txt
    d@d:~/PycharmProjects/GUIConfigurator$ cat requirements.txt 
    six==1.10.0
    setuptools==20.7.0
    evdev==0.7.0
    PyQt5==5.9
    blessings==1.6
    intelhex==2.1
    pywinusb==0.4.2
    pyusb==1.0.0
    
qmk_firmware:https://github.com/qmk/qmk_firmware  
pyxhook although it has been modified heavily: https://github.com/JeffHoogland/pyxhook
    
## Installation

    sudo apt-get update
    sudo apt-get install gcc unzip wget zip gcc-avr binutils-avr avr-libc dfu-programmer dfu-util gcc-arm-none-eabi binutils-arm-none-eabi libnewlib-arm-none-eabi
    sudo apt install python3.5 python3-pip evdev python3-xlib python3-pyqt5
    git clone https://github.com/hiro2016/ergodox_gui_configurator.git 
    
## Running

    cd ergodox_gui_configurator.git
    python3 ./main.py

Ignore the configure button. It's for switching qmk_firmware dir.
    
![Alt text](Screenshot from 2017-09-03 23-22-27.png?raw=true "Title")  

 - Open File button only let you load ekm files generated by this script.    
 - Compile button copy files to appropriate directories and runs the make command. 
See the pop up for the location of the generated hex file.  
 - Save As button saves the instance state, so you can load it to this script later.
    
![Alt text](key_configurator_type_to_conf_selected.png?raw=true "Title")  
To configure a key in type-to-configure mode, toggle on the radio
button within the circled region and select the input-literal tex field, 
then type a key on a standard keyboard.
  
##### Please do make sure when you create a keymap, the os side keyboard layout is same as the layout you will be using with your ergodox
  
Modifier mask comboboxies are for sending shift, control etc along with the hid id;
sometimes does not work.  
Do note what is shown in the input literal and key's name fields are irrelevant for
your ergodox, only the HID usage id and modifier masks matter.
  
    
### Currently escaped scancodes are not supported in type-to-configure mode
Use choose from list
  

![Alt text](key_configurator_choose_from_list_selected.png?raw=true "Title")

It's due to code collisions:
e.g.    

    hid_id  scancode_set_1      keyname  
    70 	    e0-37           PrtScr    
    85 	    37 	            KP-*    
    
If you wish you can edit GUIComponents/SelectSpecialActionComponent:

        #"display stirng":"the value inserted into keymap."
        qmk_options = {
            "None":None,
            "TT":"TT",
            "MO":"MO",
            "TO":"TO",
            "TG":"TG",
            "RESET":"RESET",
            "- and _(us only)":'0x2d',
            "Mute":'0x7f',
            "= and +(us only)":'0x2e',
            '\' and \"(us only)':'0x34',
            'Pause': '0x48',
            'Keyboard Scroll Lock': '0x47',
            'PrintScreen': '0x46',
            'Volume Up':  '0x80',
            'Volume Down':  '0x81',

and add new hid usage id options. You can find ids at: http://www.usb.org/developers/hidpage/Hut1_12v2.pdf

### Known issues  
`CTL_T(LSFT(KC_*))` combination does not work.   
`LALT_T(LSFT(KC_X))` is also not working.   
The mapping between x11 keycodes and hid usage ids are 
incomplete; in type-to-configure-mode pressing some keys 
may crash the script.  
The code is ugly beyond words.  


